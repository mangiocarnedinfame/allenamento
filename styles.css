/* styles.css - Fixed: stabilized wheel highlighting based on vertical center position */
:root{
  --bg: #0f1114;
  --card: #0e1114;
  --muted: #9aa3ad;
  --accent-start: #4de0a6;
  --accent-mid: #ffd166;
  --accent-end: #ff6b6b;
  --glass: rgba(255,255,255,0.03);
  --size: 340px;
  --ring-bg: rgba(255,255,255,0.06);
  --ring-color: var(--accent-start);
  --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --wheel-item-h: 128px;
  --wheel-font-size: 88px;
}

* {box-sizing: border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:var(--font-sans);
  background:linear-gradient(180deg,#081018 0%, #0b0d10 100%);
  color:#e9eef2;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:28px;
}

.app{ width:min(1000px,100%); text-align:center; }

.title{ display:none !important;
  font-weight:800;
  margin:0 0 12px 0;
  font-size:22px;
  letter-spacing:1px;
  color: #dff7ee;
  text-shadow: 0 2px 12px rgba(0,0,0,0.6);
}

.topbar{ display:flex; flex-direction:column; align-items:center; gap:12px; margin-bottom:18px; }
.mode-switch{ display:flex; gap:8px; background:rgba(255,255,255,0.05); padding:6px; border-radius:12px; position:sticky; top:12px; z-index:1000; backdrop-filter: blur(6px); }
.seg{ border:0; border-radius:8px; padding:8px 14px; color:#cfe8dc; background:transparent; font-weight:800; cursor:pointer; }
.seg.selected{ background:linear-gradient(90deg,var(--accent-start),var(--accent-mid)); color:#06201b; }

.timer-area{ display:flex; flex-direction:column; align-items:center; gap:16px; }

.clock-wrap{
  width:var(--size);
  height:var(--size);
  display:grid;
  place-items:center;
  position:relative;
  cursor:pointer;
  perspective:1000px;
  border-radius:999px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
  box-shadow: 0 12px 60px rgba(2,6,12,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  transition:transform .12s ease;
  outline: none;
  padding:14px;
}
.clock-wrap:active{ transform: scale(.995) }

.clock-wrap.paused {
  background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.08));
  box-shadow: 0 8px 40px rgba(2,6,12,0.4), inset 0 1px 0 rgba(255,255,255,0.01);
}

.progress-ring{ position:absolute; inset:0; width:100%; height:100%; transform: rotate(-90deg); pointer-events:none; }
.ring-bg{ stroke: var(--ring-bg); stroke-width:12; }
.ring{ stroke: var(--ring-color); stroke-width:12; transition: stroke-width .35s ease, stroke .3s linear; transform-origin: 50% 50%; will-change: stroke-dashoffset, stroke; }

.time-label{
  z-index:2;
  font-size:52px;
  font-weight:900;
  letter-spacing:1px;
  user-select:none;
  text-shadow: 0 12px 44px rgba(0,0,0,0.75), 0 1px 0 rgba(255,255,255,0.02);
}
.time-label.paused { opacity: 0.8; text-shadow: 0 8px 32px rgba(0,0,0,0.6), 0 1px 0 rgba(255,255,255,0.01); }

.phase-label{
  display:inline-block;
  color:#05221a;
  font-weight:900;
  letter-spacing:1px;
  font-size: clamp(20px, 4vw, 28px);
  text-transform: uppercase;
  padding:10px 16px;
  border-radius:999px;
  background: linear-gradient(90deg,var(--accent-start),var(--accent-mid));
  box-shadow: 0 10px 36px rgba(0,0,0,0.45), 0 0 0 6px rgba(77,224,166,0.10);
  margin: 6px 0 -2px 0;
}

.controls{ display:flex; gap:18px; align-items:center; justify-content:center }
.btn{ border:0; padding:12px 22px; border-radius:12px; font-weight:800; cursor:pointer; font-size:16px; background:transparent; color:var(--muted); transition: transform .12s ease, box-shadow .12s ease; }
.btn:active{ transform: translateY(1px) }
.btn.primary{
  background: linear-gradient(90deg,var(--accent-start),var(--accent-mid));
  color:#041014;
  box-shadow: 0 22px 72px rgba(77,224,166,0.18);
  padding:22px 34px;
  font-size:20px;
  border-radius:16px;
  min-width:160px;
  letter-spacing:0.6px;
}
.btn.secondary{ background: linear-gradient(90deg,#22262a,#191b1d); color:var(--muted); padding:16px 22px; font-size:16px; }

.hint{ margin:0; color:var(--muted); font-size:14px; }

/* GYM grid */
.gym-area{ display:flex; flex-direction:column; align-items:center; gap:18px; }
.gym-grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(160px, 1fr));
  gap:16px;
  width:min(720px, 100%);
  position:relative;
}
.circle-small{
  display:grid;
  place-items:center;
  gap:8px;
  border-radius:999px;
  padding:16px;
  aspect-ratio:1/1;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
  box-shadow: 0 12px 60px rgba(2,6,12,0.5), inset 0 1px 0 rgba(255,255,255,0.02);
  border:1px solid rgba(255,255,255,0.03);
  cursor:pointer;
  position:relative;
  will-change: transform, opacity;
}
.circle-small:active{ transform: scale(.99) }
.circle-title{ color:var(--muted); font-weight:800; font-size:14px; }
.circle-value{ font-weight:900; font-size:28px; letter-spacing:.5px; }

/* Collapse animation */
@keyframes collapse-to-center {
  0% { transform: translate(0,0) scale(1) rotate(0deg); filter: blur(0px); opacity:1; }
  100% { transform: translate(var(--dx,0), var(--dy,0)) scale(0.24) rotate(var(--rot, 10deg)); filter: blur(4px); opacity:0; }
}
.circle-small.collapse-anim{
  animation: collapse-to-center .55s cubic-bezier(.18,.92,.22,1) forwards;
}

/* Picker overlay full screen */
.overlay{ position:fixed; inset:0; display:grid; place-items:center; background: linear-gradient(0deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6)); z-index:1200; padding:0; }
.overlay[hidden]{ display:none !important; }

.picker{
  width:100%;
  height:100dvh;
  height:100lvh;
  height:100vh;
  max-width:none;
  border-radius:0;
  padding:18px 20px;
  position:relative;
  display:flex;
  flex-direction:column;
  gap:12px;
  background: linear-gradient(180deg, rgba(3,6,8,0.96), rgba(6,10,14,0.96));
  color:#eaf7ee;
}
.picker-header{ height:64px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
.picker-header h2{ margin:0; font-size:20px; font-weight:800; }
.picker-body{
  flex:1 1 auto;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:12px;
  gap:18px;
  overflow:hidden;
  padding-bottom: calc(env(safe-area-inset-bottom, 12px) + 96px);
}
.picker-footer{
  position: fixed;
  left: 0;
  right: 0;
  bottom: calc(env(safe-area-inset-bottom, 12px));
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:12px;
  padding:12px 20px;
  z-index: 1400;
  pointer-events:auto;
  backdrop-filter: blur(6px);
  background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.06));
  box-shadow: 0 -6px 28px rgba(0,0,0,0.45);
}
.picker-footer .btn { pointer-events: auto; z-index: 1401; }

/* Enhanced Wheels System - Fixed positioning and stable highlighting */
.wheels{ 
  display:flex; 
  flex-direction:row; 
  gap:18px; 
  justify-content:center; 
  align-items:stretch; 
  width:100%; 
  max-width:1400px; 
  padding:0 12px; 
  box-sizing:border-box; 
  overflow:hidden;
  height:100%;
}
.wheels.one-col{ gap:0; justify-content:center; }
.wheel-col{ 
  flex: 1 1 0; 
  min-width:0; 
  max-width:50%; 
  display:flex; 
  flex-direction:column; 
  gap:8px; 
  align-items:center;
  height:100%;
}
.wheels.one-col .wheel-col{ max-width:560px; flex: 0 1 560px; }
.wheel-label{ color:var(--muted); font-size:15px; font-weight:700; flex-shrink:0; }

.wheel{
  width:100%;
  flex:1;
  border-radius:14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));
  overflow-y:auto;
  overflow-x:hidden;
  scroll-snap-type: y mandatory;
  -webkit-overflow-scrolling: touch;
  transform-style:preserve-3d;
  perspective:900px;
  padding:0;
  position:relative;
  border:1px solid rgba(255,255,255,0.03);
  touch-action: pan-y;
  overscroll-behavior: contain;
  user-select: none;
  scrollbar-width: thin;
  scroll-behavior: auto;
}

/* Smooth scrolling class for snapping */
.wheel.smooth-scroll { 
  scroll-behavior: smooth; 
}

/* Fixed highlight zone - always centered */
.wheel::before{
  content:"";
  position:absolute;
  left:12px; 
  right:12px;
  height:var(--wheel-item-h);
  top:calc(50% - (var(--wheel-item-h) / 2));
  border-radius:12px;
  pointer-events:none;
  /* Strong, stationary highlight that stays in center */
  box-shadow:
    inset 0 0 0 2px rgba(255,255,255,0.12),
    0 8px 32px rgba(0,0,0,0.4);
  background:
    linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.08));
  z-index: 20;
  opacity: 1;
  transform: none;
  backdrop-filter: blur(2px);
}

.list{ 
  list-style:none; 
  padding:0; 
  margin:0; 
  display:block; 
  width:100%; 
  position:relative;
}

.wheel-item{
  scroll-snap-stop: always;
  height:var(--wheel-item-h);
  line-height:var(--wheel-item-h);
  font-weight:900;
  color:var(--muted);
  text-align:center;
  scroll-snap-align:center;
  user-select:none;
  font-size:var(--wheel-font-size);
  transition: color .2s ease, text-shadow .2s ease, opacity .2s ease;
  transform-origin: center center;
  width:100%;
  box-sizing:border-box;
  padding:0 8px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  position:relative;
  z-index: 10;
  /* Default state: slightly dimmed */
  opacity: 0.5;
}

/* Enhanced selected state - based on position, not dynamic class */
.wheel-item.selected{
  color: #e8f7f0;
  opacity: 1;
  text-shadow: 0 6px 24px rgba(0,0,0,0.5);
  font-weight: 900;
  /* No transform - keep items flat so only the fixed highlight provides depth */
  transform: none;
  background: transparent;
  z-index: 15;
}

/* Spacer elements for proper centering */
.spacer{ 
  visibility:hidden; 
  height:var(--wheel-item-h); 
  scroll-snap-align: none !important; 
  opacity: 0;
  pointer-events: none;
}

/* Responsive adjustments */
@media (max-width:520px){
  :root{ --wheel-item-h: 100px; --wheel-font-size:64px; --size:300px; }
  .time-label{ font-size:48px }
}

@media (max-width:360px){
  .wheels{ flex-direction:column; gap:12px; padding:0 20px; }
  .wheel-col{ width:100%; max-width:none; min-width:unset; flex:1; }
  :root{ --wheel-item-h: 64px; --wheel-font-size:36px }
}

/* A11y helpers */
.visually-hidden{ position:absolute !important; width:1px; height:1px; margin:-1px; border:0; padding:0; clip:rect(0 0 0 0); overflow:hidden; }

/* Ensure any [hidden] element is really hidden (overrides our layout rules) */
[hidden]{ display:none !important; }

/* Optional magic burst animation */
.magic-burst{
  position: fixed;
  left: 0; top: 0;
  width: 24px; height: 24px;
  border-radius: 999px;
  pointer-events: none;
  background: radial-gradient(circle at center, rgba(255,255,255,0.75) 0%, rgba(255,255,255,0.35) 15%, rgba(255,255,255,0.0) 70%);
  mix-blend-mode: screen;
  transform: translate(var(--x,0px), var(--y,0px)) scale(0.1);
  opacity: 0.9;
  animation: burst-out .52s cubic-bezier(.26,.86,.24,1) forwards;
  z-index: 2000;
  box-shadow: 0 0 60px rgba(77,224,166,0.25);
}
@keyframes burst-out{
  to{
    transform: translate(var(--x,0px), var(--y,0px)) scale(6.0);
    opacity: 0;
    box-shadow: 0 0 0 rgba(77,224,166,0.0);
  }
}

.magic-burst::after{
  content: "";
  position: absolute; inset: 0;
  border-radius: 999px;
  box-shadow: 0 0 0 2px rgba(255,255,255,0.65);
  animation: ring-out .58s ease-out forwards;
}
@keyframes ring-out{
  to{ transform: scale(4.4); opacity: 0; }
}
